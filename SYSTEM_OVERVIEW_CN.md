# V4 系统成果与研究框架（对外说明版）

更新日期：2026-02-11  
目的：面向外部读者，用中文清晰说明系统逻辑、模块化结构、数据处理、因子进入与组合验证流程。

---

## 1) 系统定位与边界
1. 定位：日频量化评分与回测（使用常规交易时段 open/close 日线）。  
2. 不做：高频日内/逐笔级别信号与执行。  
3. 核心原则：PIT（可得时点）处理、可追溯、可复现、分阶段验证。  

---

## 2) 系统逻辑与模块化结构
系统以“配置驱动 + 引擎模块化”实现标准化回测，核心逻辑是“数据 → 信号 → 执行 → 诊断”的闭环。

### 2.1 数据输入与 PIT（防前视）
1. 价格数据：日线 open/close，包含在市与退市。  
2. 退市处理：使用退市清单裁剪价格，避免幸存者偏差。  
3. 复权处理：优先使用复权价格目录，缺失时回退非复权目录。  
4. 基本面 PIT：优先使用 available_date（acceptedDate/fillingDate），确保“可得时点”。  
5. 关键数据目录：  
   - 价格：`data/prices*` 与 `data/prices_delisted*`  
   - 基本面：`data/fmp/ratios/quality/`、`data/fmp/ratios/value/`  
   - 市值历史：`data/fmp/market_cap_history/`  
   - 行业映射：`data/company_profiles.csv`  
6. 后续可扩展：引入更高频的交易所级别清洗与企业行动校验。  

### 2.2 交易日历与再平衡（离散日期驱动）
1. 基于 SPY 或替代标的生成交易日历。  
2. 再平衡为离散日期驱动（非逐日）。  
3. 信号只在再平衡日计算与建仓，事件因子同样受调仓门控。  
4. 后续可扩展：支持多频率调仓与更灵活的交易日历。  

### 2.3 Universe 构建（可交易池）
1. 退市过滤。  
2. 价格与流动性过滤：最小价格、最小成交额。  
3. 市值过滤（PIT）：仅当市值历史存在时启用。  
4. 缺失与异常数据过滤，保证信号与收益有足够样本。  
5. 后续可扩展：更多风险/流动性约束与区域化市场过滤。  

### 2.4 因子计算（Factor Engine）
1. 单因子或多因子组合信号。  
2. 因子权重可配置，组合信号为加权和。  
3. 输出 signal，支持输出因子组件用于相关性与冗余诊断。  
4. 后续可扩展：非线性组合与条件化因子权重。  

### 2.5 因子工厂（标准化与对齐）
1. 标准化：rank / zscore。  
2. 去极值：winsor（分位裁剪）。  
3. 缺失处理：drop / fill / keep。  
4. 行业中性与 size/beta 中性（可选）。  
5. 全局与单因子 lag 对齐。  
6. 后续可扩展：更复杂的去偏与稳健标准化方案。  

### 2.6 执行模拟（Execution Simulator）
1. 执行与持有：T+N 自然日偏移。  
2. 价格：优先 open，缺失时回退 close。  
3. 成本：基础成本 + 成本压力测试（2x/3x）。  
4. 退市与缺失价格时的保守退出逻辑。  
5. 后续可扩展：冲击成本与成交可行性模型的实证校准。  

### 2.7 绩效分析（Performance Analyzer）
1. 逐期 IC（更稳健）与总体 IC。  
2. 信号覆盖、统计指标、回测质量指标。  
3. 输出可用于报告与组合诊断的中间数据。  
4. 后续可扩展：更完整的风险归因与收益分解。  

---

## 3) 因子进入与验证总流程（专业机构基线）
每个新因子进入系统，必须按同一流程闭环，避免“只凭单次结果”。

---

### 3.1 因子定义（模块化参数）
必须明确：  
1. 公式与方向。  
2. lookback、lag、winsor、标准化方式。  
3. 中性化方式（行业/size/beta）。  
4. 数据依赖与 PIT 字段。  
5. Universe 过滤与执行规则。  
6. 事件因子需要明确时间对齐规则。  

### 3.2 Stage 1（基线稳定性）
目的：最小可用基线。  
处理：winsor + rank。  
方法：分段 IC（例如 2 年一段）验证稳定性。

### 3.3 Stage 2（机构版稳健性）
目的：机构化处理对照。  
处理：行业中性 + size/beta 中性 + zscore（可选平滑）。  
方法：分段 IC 与 Stage 1 对比，验证鲁棒性。

### 3.4 Train/Test（过拟合检验）
固定训练集与测试集，验证 OOS 稳定性。

### 3.5 专业报告（量化诊断）
输出必须包含：  
1. 分位回报。  
2. 滚动 IC。  
3. 换手。  
4. 成本敏感性（2x/3x）。  

### 3.6 风险模型与归因
在单因子层面评估：  
1. 行业/风格/市场因子暴露（当前为简化版本）。  
2. 暴露稳定性与方向一致性。  
3. 后续可扩展：完整风格因子体系与风险预算。  

### 3.7 成本与容量模型
在单因子层面评估：  
1. 基础成本与冲击成本（当前为简化版本）。  
2. 成交可行性与容量约束。  
3. 后续可扩展：基于成交与冲击的容量实证校准。  

### 3.8 研究结果版本化绑定
所有结论强绑定：  
1. 数据版本（FMP 批次与更新时间）。  
2. 代码版本（仓库与提交哈希）。  
3. 参数版本（策略配置与覆盖参数）。  
4. 后续可扩展：自动化审计链路与报告签名。  

### 3.9 鲁棒性矩阵
形成结构化矩阵报告：  
1. 参数扰动矩阵（lookback ±20%）。  
2. 标准化矩阵（rank vs zscore）。  
3. 子样本矩阵（大盘/高流动性）。  
4. 市场状态矩阵（趋势/震荡等）。  
5. 后续可扩展：更多市场状态与因子交互维度。  

---

## 4) 组合前的准入标准（单因子）
默认要求（可按项目调整）：  
1. 分段 IC 多数为正，无持续负段。  
2. Train/Test 不塌陷，测试集仍为正或接近 0。  
3. 成本倍率下仍为正。  
4. rank vs zscore 不改变方向。  
5. 子样本（大盘或高流动性）至少一项稳定。  

---

## 5) 多因子组合流程（专业机构基线）
当 2–3 个单因子通过准入后，才进入组合流程。

### 5.1 组合方式
1. 标准化后加权平均，或权重和（权重可等权或基于稳定性）。  
2. 因子组件保留，用于相关性与冗余诊断。  
3. 后续可扩展：动态权重与风险平价类组合。  

### 5.2 组合检验
1. 分段 IC。  
2. Train/Test。  
3. 成本敏感性（2x/3x）。  
4. 因子相关性与冗余诊断。  
5. 组合风险归因与风险预算符合性。  
6. 组合容量与成交可行性评估。  
7. 组合滚动回测（Walk‑forward）：滚动训练/测试，验证可部署性。  
8. 后续可扩展：多目标优化与约束条件的组合评估。  

### 5.3 组合准入
组合必须优于至少一个单因子基线，且成本倍率下不塌陷。  
如需更多组合策略（如动态权重、风险平价、信号择时），仍在持续开发与验证中。  

---

## 6) 数据与可信度
系统强调 PIT 与数据完整性：  
1. 退市名单与退市价格覆盖。  
2. 基本面 available_date 支持。  
3. 数据完整性与风险说明文档。  

---

## 7) 具体示例：Low‑vol / Value / Quality 的进入流程与数据口径
以下示例描述三个因子如何进入系统并被验证。

### 7.1 Low‑vol（低波）
1. 数据依赖：日线价格 + SPY 残差波动；可选仅统计下行波动。  
2. 数据目录：`data/prices*` 与 `data/prices_delisted*`。  
2. Stage 1：winsor + rank 分段 IC。  
3. Stage 2：行业中性 + size/beta 中性 + zscore。  
4. Train/Test 与专业报告，重点看成本敏感性与换手。  

### 7.2 Value（估值）
1. 数据依赖：FMP 估值比率（PIT available_date）。  
2. 数据目录：`data/fmp/ratios/value/`。  
2. Stage 1：winsor + rank，分段 IC 稳定性。  
3. Stage 2：行业中性 + size/beta 中性 + zscore。  
4. Train/Test 与专业报告，重点看分位回报与成本压力。  

### 7.3 Quality（质量）
1. 数据依赖：FMP 质量组合（ROE/ROA/毛利率/CFO/资产/负债惩罚）。  
2. 数据目录：`data/fmp/ratios/quality/`。  
2. Stage 1：winsor + rank，分段 IC 稳定性。  
3. Stage 2：行业中性 + size/beta 中性 + zscore。  
4. Train/Test 与专业报告，重点看稳定性与 OOS。  

---

## 8) 关键结论（对外可用）
这是一个**日频、PIT、可追溯、可复现**的多因子研究系统。  
每个因子必须经过 **Stage 1 → Stage 2 → Train/Test → 专业报告** 才允许进入组合，且组合必须通过成本与相关性检验。  

---


---
